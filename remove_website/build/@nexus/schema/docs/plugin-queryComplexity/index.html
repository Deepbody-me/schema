<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Query Complexity Plugin · GraphQL Nexus</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A single GraphQL query can potentially generate a huge workload for a server, like thousands of database operations which can be used to cause DDoS attacks. In order to limit and keep track of what each GraphQL operation can do, the query complexity plugin allows defining field-level complexity values that works with the [graphql-query-complexity](https://github.com/slicknode/graphql-query-complexity) library."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Query Complexity Plugin · GraphQL Nexus"/><meta property="og:type" content="website"/><meta property="og:url" content="https://nexus.js.org/"/><meta property="og:description" content="A single GraphQL query can potentially generate a huge workload for a server, like thousands of database operations which can be used to cause DDoS attacks. In order to limit and keep track of what each GraphQL operation can do, the query complexity plugin allows defining field-level complexity values that works with the [graphql-query-complexity](https://github.com/slicknode/graphql-query-complexity) library."/><meta property="og:image" content="https://nexus.js.org/img/nexus-dark.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://nexus.js.org/img/nexus-dark.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-39763513-4', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://use.fontawesome.com/releases/v5.7.1/js/all.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/nexus.png" alt="GraphQL Nexus"/><h2 class="headerTitleWithLogo">GraphQL Nexus</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="/playground" target="_self">Playground</a></li><li class=""><a href="/converter" target="_self">SDL Converter</a></li><li class=""><a href="https://github.com/graphql-nexus/schema/tree/develop/examples" target="_self">Examples</a></li><li class=""><a href="https://github.com/graphql-nexus/schema" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Included Plugins</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Documentation</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/best-practices">Best Practices</a></li><li class="navListItem"><a class="navItem" href="/docs/type-generation">Type Generation Details</a></li><li class="navListItem"><a class="navItem" href="/docs/library-authors">Library Authors</a></li><li class="navListItem"><a class="navItem" href="/docs/why-graphql-nexus">Why Nexus?</a></li><li class="navListItem"><a class="navItem" href="/docs/future-features">Potential Future Features</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/api-core-concepts">API Core Concepts</a></li><li class="navListItem"><a class="navItem" href="/docs/api-objectType">objectType</a></li><li class="navListItem"><a class="navItem" href="/docs/api-unionType">unionType</a></li><li class="navListItem"><a class="navItem" href="/docs/api-scalarType">scalarType</a></li><li class="navListItem"><a class="navItem" href="/docs/api-interfaceType">interfaceType</a></li><li class="navListItem"><a class="navItem" href="/docs/api-inputObjectType">inputObjectType</a></li><li class="navListItem"><a class="navItem" href="/docs/api-enumType">enumType</a></li><li class="navListItem"><a class="navItem" href="/docs/api-args">args: arg / *Arg</a></li><li class="navListItem"><a class="navItem" href="/docs/api-makeSchema">makeSchema</a></li><li class="navListItem"><a class="navItem" href="/docs/api-extendType">extendType</a></li><li class="navListItem"><a class="navItem" href="/docs/api-mutationField">mutationField</a></li><li class="navListItem"><a class="navItem" href="/docs/api-queryField">queryField</a></li><li class="navListItem"><a class="navItem" href="/docs/api-plugins">Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Included Plugins</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/plugin-connection">Connections</a></li><li class="navListItem"><a class="navItem" href="/docs/plugin-fieldAuthorize">Field Authorize</a></li><li class="navListItem"><a class="navItem" href="/docs/plugin-nullabilityGuard">Nullability Guard</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/plugin-queryComplexity">Query Complexity</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Ecosystem Plugins</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/nexus-prisma">nexus-prisma</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Query Complexity Plugin</h1></header><article><div><span><p>A single GraphQL query can potentially generate a huge workload for a server, like thousands of database operations which can be used to cause DDoS attacks. In order to limit and keep track of what each GraphQL operation can do, the query complexity plugin allows defining field-level complexity values that works with the <a href="https://github.com/slicknode/graphql-query-complexity">graphql-query-complexity</a> library.</p>
<p>To install, add the <code>queryComplexityPlugin</code> to the <code>makeSchema.plugins</code> array, along with any other plugins you'd like to include:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { makeSchema, queryComplexityPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"@nexus/schema"</span>;

<span class="hljs-keyword">const</span> schema = makeSchema({
  <span class="hljs-comment">// ... types, etc,</span>
  plugins: [
    <span class="hljs-comment">// ... other plugins</span>
    queryComplexityPlugin(),
  ],
});
</code></pre>
<p>The plugin will install a <code>complexity</code> property on the output field config:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> User = objectType({
  name: <span class="hljs-string">"User"</span>,
  definition(t) {
    t.id(<span class="hljs-string">"id"</span>, {
      complexity: <span class="hljs-number">2</span>,
    });
  },
});
</code></pre>
<p>And of course, integrate <code>graphql-query-complexity</code> with your GraphQL server. You can setup with <code>express-graphql</code> as in <a href="https://github.com/slicknode/graphql-query-complexity#usage-with-express-graphql">the library's example</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="complexity-value"></a><a href="#complexity-value" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Complexity Value</h3>
<p>There are two ways to define the complexity:</p>
<ul>
<li>A number</li>
<li>A complexity estimator</li>
</ul>
<p>The easiest way to specify the complexity is to just provide a number, as in the example code above. The <code>complexity</code> property can be omitted if its value is <code>1</code>, provided that you have a simple estimator of 1 when configuring <code>graphql-query-complexity</code> like below:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">const</span> complexity = getComplexity({
  <span class="hljs-comment">// ... other configurations</span>
  estimators: [
    <span class="hljs-comment">// All undefined complexity values will fallback to 1</span>
    simpleEstimator({ defaultComplexity: <span class="hljs-number">1</span> }),
  ],
});
</code></pre>
<p>Another way is with the complexity estimator, which is a function that returns a number, but also provides arguments to compute the final value. The query complexity plugin augments <code>graphql-query-complexity</code>'s default complexity estimator by providing its corresponding nexus types to ensure type-safety. No additional arguments are introduced so the function declaration is still syntactically equal.</p>
<p>Augmented complexity estimator function signature:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">type</span> QueryComplexityEstimatorArgs&lt;
  TypeName <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>,
  FieldName <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>
&gt; = {
  <span class="hljs-comment">// The root type the field belongs too</span>
  <span class="hljs-keyword">type</span>: RootValue&lt;TypeName&gt;;

  <span class="hljs-comment">// The GraphQLField that is being evaluated</span>
  field: GraphQLField&lt;
    RootValue&lt;TypeName&gt;,
    GetGen&lt;<span class="hljs-string">"context"</span>&gt;,
    ArgsValue&lt;TypeName, FieldName&gt;
  &gt;;

  <span class="hljs-comment">// The input arguments of the field</span>
  args: ArgsValue&lt;TypeName, FieldName&gt;;

  <span class="hljs-comment">// The complexity of all child selections for that field</span>
  childComplexity: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">type</span> QueryComplexityEstimator = (
  options: QueryComplexityEstimatorArgs
) =&gt; <span class="hljs-built_in">number</span> | <span class="hljs-built_in">void</span>;
</code></pre>
<p>And you can use it like so:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> users = queryField(<span class="hljs-string">"users"</span>, {
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"User"</span>,
  list: <span class="hljs-literal">true</span>,
  args: {
    count: intArg({ nullable: <span class="hljs-literal">false</span> }),
  },
  <span class="hljs-comment">// This will calculate the complexity based on the count and child complexity.</span>
  <span class="hljs-comment">// This is useful to prevent clients from querying mass amount of data.</span>
  complexity: <span class="hljs-function">(<span class="hljs-params">{ args, childComplexity }</span>) =&gt;</span> args.count * childComplexity,
  resolve: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> [{ id: <span class="hljs-string">"1"</span> }],
});
</code></pre>
<p>For more info about how query complexity is computed, please visit <a href="https://github.com/slicknode/graphql-query-complexity">graphql-query-complexity</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/plugin-nullabilityGuard"><span class="arrow-prev">← </span><span>Nullability Guard</span></a><a class="docs-next button" href="/docs/nexus-prisma"><span>nexus-prisma</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/nexus.png" alt="GraphQL Nexus" width="66"/></a><div><h5>Docs</h5><a href="/docs/getting-started">Getting Started</a><a href="/docs/api-core-concepts">API Reference</a><a href="/playground">Playground</a></div><div><h5>More</h5><a href="https://github.com/graphql-nexus/nexus">GitHub</a><a class="github-button" href="https://github.com/prisma-labs/nexus" data-icon="octicon-star" data-count-href="/graphql-nexus/nexus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 Tim Griesser</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '80f72460aa3d84abf56948140313b079',
                indexName: 'graphql-nexus',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>